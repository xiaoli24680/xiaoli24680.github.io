<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="John Doe"><link rel="alternative" href="/atom.xml" title="木肃的博客" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>windows和Linux下搭建VPN - 木肃的博客</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">木肃的博客</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">目录</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-12-30T04:34:31.000Z">十二月 30, 2018</time><h1 class="post__title"><a href="/2018/12/30/Windows和Linux下搭建VPN/">windows和Linux下搭建VPN</a></h1><div class="post__main echo"><h1 id="Windows-Server-2008"><a href="#Windows-Server-2008" class="headerlink" title="Windows Server 2008"></a>Windows Server 2008</h1><h2 id="安装路由与远程访问"><a href="#安装路由与远程访问" class="headerlink" title="安装路由与远程访问"></a>安装路由与远程访问</h2><p>按照图片上的来，没有截图的界面就选择下一步：</p>
<p><strong>安装网络策略和访问服务</strong></p>
<p><img src="/vpn/01.png" alt="vpn"></p>
<p><img src="/vpn/02.png" alt="vpn"></p>
<p><strong>配置并启用路由和远程访问</strong></p>
<p><img src="/vpn/03.png" alt="vpn"></p>
<p><img src="/vpn/04.png" alt="vpn"></p>
<p><img src="/vpn/05.png" alt="vpn"></p>
<p><img src="/vpn/06.png" alt="vpn"></p>
<p><strong>新增接口</strong></p>
<p><img src="/vpn/07.png" alt="vpn"></p>
<p><img src="/vpn/08.png" alt="vpn"></p>
<p><img src="/vpn/09.png" alt="vpn"></p>
<h2 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h2><p><img src="/vpn/10.png" alt="vpn"></p>
<p>添加用户，自定义名字<code>vpntest</code><br><img src="/vpn/11.png" alt="vpn"></p>
<h2 id="网络安全策略"><a href="#网络安全策略" class="headerlink" title="网络安全策略"></a>网络安全策略</h2><p><img src="/vpn/12.png" alt="vpn"></p>
<p><img src="/vpn/13.png" alt="vpn"></p>
<p><img src="/vpn/14.png" alt="vpn"></p>
<p><img src="/vpn/15.png" alt="vpn"></p>
<p><img src="/vpn/16.png" alt="vpn"></p>
<h2 id="本地安全策略"><a href="#本地安全策略" class="headerlink" title="本地安全策略"></a>本地安全策略</h2><p><img src="/vpn/17.png" alt="vpn"></p>
<p><img src="/vpn/18.png" alt="vpn"></p>
<p><img src="/vpn/19.png" alt="vpn"></p>
<p>输入之前创建用户时的自定义名字<code>vpntest</code><br><img src="/vpn/20.png" alt="vpn"></p>
<h2 id="连接测试"><a href="#连接测试" class="headerlink" title="连接测试"></a>连接测试</h2><p><img src="/vpn/21.png" alt="vpn"></p>
<p><img src="/vpn/22.png" alt="vpn"></p>
<p><img src="/vpn/23.png" alt="vpn"></p>
<p><img src="/img/vpn/24.png" alt="vpn"></p>
<p>输入创建用户时的用户名和密码：<br><img src="/vpn/25.png" alt="vpn"></p>
<p><img src="/vpn/26.png" alt="vpn"></p>
<p>ok</p>
<h1 id="Ubuntu-18"><a href="#Ubuntu-18" class="headerlink" title="Ubuntu 18"></a>Ubuntu 18</h1><p>在linux里有一种特别棒的项目，叫docker，功能就相当于VMware workstation，可以安装虚拟镜像，但是docker不对硬件进行虚拟化，所以运行起来会特别的快，关于docker，github上有详细的介绍，易懂，在接下来安装VPN之前，我将先介绍如何安装docker，随后用docker安装VPN</p>
<h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><p>我用的<code>Termius</code>连接的ubuntu，在这里面复制粘贴相对简单</p>
<p><img src="/vpn/termius01.png" alt="vpn"></p>
<h3 id="更新apt源"><a href="#更新apt源" class="headerlink" title="更新apt源"></a>更新apt源</h3><p>要更新的源的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/</span><br></pre></td></tr></table></figure>
<p>备份原有的源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/apt/sources.list /etc/apt/sources.list.backup</span><br></pre></td></tr></table></figure>
<p>修改apt源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">打开</span><br><span class="line">vi /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">`dd`删除</span><br><span class="line">复制清华的源放入</span><br><span class="line">保存，退出</span><br></pre></td></tr></table></figure>
<p>更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<h3 id="使用apt安装"><a href="#使用apt安装" class="headerlink" title="使用apt安装"></a>使用apt安装</h3><p>由于 <code>apt</code> 源使用 HTTPS 以确保软件下载过程中不被篡改。因此，我们首先需要添加使用 HTTPS 传输的软件包以及 CA 证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    software-properties-common</span><br></pre></td></tr></table></figure>
<p>为了确认所下载软件包的合法性，需要添加软件源的 <code>GPG</code> 密钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>
<p>然后，我们需要向 <code>source.list</code> 中添加 Docker 软件源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository \</span><br><span class="line">    &quot;deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu \</span><br><span class="line">    $(lsb_release -cs) \</span><br><span class="line">    stable&quot;</span><br></pre></td></tr></table></figure>
<h3 id="安装-Docker-CE"><a href="#安装-Docker-CE" class="headerlink" title="安装 Docker CE"></a>安装 Docker CE</h3><p>更新 apt 软件包缓存，并安装 <code>docker-ce</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line">sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure>
<h2 id="镜像加速"><a href="#镜像加速" class="headerlink" title="镜像加速"></a>镜像加速</h2><p>国内从 Docker Hub 拉取镜像有时会遇到困难，此时可以配置镜像加速器。Docker 官方和国内很多云服务商都提供了国内加速器服务</p>
<h3 id="Ubuntu-16-04-、Debian-8-、CentOS-7"><a href="#Ubuntu-16-04-、Debian-8-、CentOS-7" class="headerlink" title="Ubuntu 16.04+、Debian 8+、CentOS 7"></a>Ubuntu 16.04+、Debian 8+、CentOS 7</h3><p>在 <code>/etc/docker/daemon.json</code> 中写入如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">    &quot;https://registry.docker-cn.com&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意，一定要保证该文件符合 json 规范，否则 Docker 将不能启动</p>
</blockquote>
<p>重启docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure>
<p>验证是否安装成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure>
<h3 id="检查加速是否生效"><a href="#检查加速是否生效" class="headerlink" title="检查加速是否生效"></a>检查加速是否生效</h3><p>配置加速器之后，如果拉取镜像仍然十分缓慢，请手动检查加速器配置是否生效，在命令行执行 <code>docker info</code>，如果从结果中看到了如下内容，说明配置成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Registry Mirrors:</span><br><span class="line"> https://registry.docker-cn.com/</span><br></pre></td></tr></table></figure>
<h3 id="针对非ROOT用户"><a href="#针对非ROOT用户" class="headerlink" title="针对非ROOT用户"></a>针对非ROOT用户</h3><p>请执行如下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker</span><br><span class="line"></span><br><span class="line">sudo usermod -aG docker $&#123;USER&#125;</span><br></pre></td></tr></table></figure>
<p>重新登录</p>
<h2 id="docker使用说明"><a href="#docker使用说明" class="headerlink" title="docker使用说明"></a>docker使用说明</h2><p>网上有人总结的很好，如果有不懂可以随时翻阅</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://yeasy.gitbooks.io/docker_practice/content/image/pull.html</span><br></pre></td></tr></table></figure>
<h2 id="搭建VPN"><a href="#搭建VPN" class="headerlink" title="搭建VPN"></a>搭建VPN</h2><p>本次搭建的是PPTP模式的VPN，用到的镜像是<code>mobtitude/vpn-pptp</code></p>
<p>下载镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mobtitude/vpn-pptp</span><br></pre></td></tr></table></figure>
<p>在当前路径新建文件，文件名随意，我的命名为：<code>chap-secrets</code>，内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name  *      pass  *</span><br></pre></td></tr></table></figure>
<p>执行如下命令，注意<code>-v</code>后<code>:</code>前你的路径和文件名是否和我的一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --privileged -p 1723:1723 -v /root/chap-secrets:/etc/ppp/chap-secrets mobtitude/vpn-pptp</span><br><span class="line"></span><br><span class="line">执行成功的结果是显示一长串字符</span><br></pre></td></tr></table></figure>
<p>之后就可以连接进行测试了，和上面Windows的一样</p>
<p>如果连接不成功，可以试试下面的命令，在此之前，需要删除正在运行的容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">停止所有容器</span><br><span class="line">docker stop $(docker ps -qa)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">删除所有容器</span><br><span class="line">docker rm $(docker ps -qa)</span><br></pre></td></tr></table></figure>
<p>执行命令，注意<code>-v</code>后<code>:</code>前你的路径和文件名是否和我的一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --privileged --net host -v /root/chap-secrets:/etc/ppp/chap-secrets mobtitude/vpn-pptp</span><br></pre></td></tr></table></figure></div></header></article><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2016-2018 John Doe</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>